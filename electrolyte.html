<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Processing.js Demo</title>
</head>
<script src="processing.js"></script>
<script type="text/processing" data-processing-target="processing-canvas">


//Misanthrope process (a model of a solide-state electrolyte) 
//by Cocozza-Thivent (1985)

int i, j, k, N;
int[] x, tmp;
int[] y, tmpy;
float[] total, p;
float Z, W;
float lambda, rho, K, r;
float x1=150;
float x2=850;

void setup(){
  size(1800, 400);
  lambda=0.5;//inverse temperature
  N=100;//lattice size
  rho=0.5;//density (parameter of Bernoulli)
  K=20;//intensity for Poisson clocks for Glauber updates. (Larger the value gets, more visible the dynamics becomes.)
  x=new int[N];//configuration
  tmp=new int[N];//configuration
  y=new int[N+1];//configuration
  tmpy=new int[N+1];//configuration
  p=new float[N];
  total=new float[N+1];
  
  //set an initial configuration
  for(i=0; i<N; i++){
    if(random(1)<=rho) x[i]=1; else x[i]=0;
    //random(1) produces a float from 0 up to 1 (but 1 is not included) equally likely
  }  
  y[0]=0;
    for(i=0;i<N;i++){
      y[i+1]=y[i]+(x[i]+1);
    }
}

//define the jump rate c(n, m)
float r(float n, float m){
  if(n==1 && m==0){
  r=1.0;
  }
  else if(n>1 && m==0){
  r=1.0+lambda;
  }
  else if(n==1 && m>0){
  r=1.0-lambda;
  }
  else if(n>1 && m>0){
  r=1.0;
  }
  else if(n==0){
  r=0.0;
  }  
  return r;
}

int mod(int n, int N)
{
    int r,x;
    x=n%N;
    if(x<0){
        r=(x+N)%N;
    }
    else{
        r=x;
    }
    return r;
}


//define gk()
void mis(){
  background(255);
  
  
  //x->tmp
      for(k=0;k<N;k++){
      tmp[k]=x[k];
      }
      //y->tmpy
      for(k=0;k<N+1;k++){
      tmpy[k]=y[k];
      }
      
      total[0]=0;
      for(k=1;k<N+1;k++){
      total[k]=total[k-1]+r(tmp[mod(k,N)],tmp[mod(k+1,N)])+r(tmp[mod(k,N)],tmp[mod(k-1,N)]);
      }
      
  
 
  
  Z=random(total[N]);
  
  
       /*create a new configuration by a jump of one particle from k to k+1 (or k-1) and keep elsewhere*/
     for(k=1; k<N+1; k++){
       if(Z>=total[k-1] && Z<total[k])
       {
         W=random(total[k]-total[k-1]); /*the rate of jump happening at site k*/
         if(W<=r(tmp[mod(k,N)],tmp[mod(k+1,N)])){
           for(j=0;j<N;j++){
             if(j==mod(k,N)){
             x[j]=tmp[j]-1;  /*allow one particle to jump from k to k+1*/
             y[j]=tmpy[j];
             }
             else if(j==mod(k+1,N)){
              x[j]=tmp[j]+1;  /*allow one particle to be in k+1 from k */
              y[j]=tmpy[j]-1;
             }
             else{    
             x[j]=tmp[j];
             y[j]=tmpy[j];
             }
           }
         }
         else if(W>r(tmp[mod(k,N)],tmp[mod(k+1,N)])){
           for(j=0;j<N;j++){
             if(j==mod(k,N)){
             x[j]=tmp[j]-1;  /*allow one particle to jump from k to k+1*/
             y[j]=tmpy[j]+1;
             }
             else if(j==mod(k-1,N)){
              x[j]=tmp[j]+1;  /*allow one particle to be in k+1 from k */
              y[j]=tmpy[j];
             }
             else{    
             x[j]=tmp[j];
             y[j]=tmpy[j];
             }
           }
         }
       }
       
     }
  
  
  
  
  
 
  for(i=1; i<N+1; i++){
      //stroke(#7FFFD0);
      fill(#7FFFD0);
      ellipse(100+y[mod(i,N)]*10,150,6,6);
  }
}

void draw(){
  frameRate(60);
  for(i=0; i<100; i++){
    for(j=0; j<100; j++){
      mis();//defined above
    }
  }
}

  
  
</script>
<canvas id="processing-canvas"></canvas>
</body>
</html>
